<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d6d6d; -webkit-text-stroke: #6d6d6d}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6b0001; -webkit-text-stroke: #6b0001}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #fb0007; -webkit-text-stroke: #fb0007}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0000ff; -webkit-text-stroke: #0000ff}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4d5055; -webkit-text-stroke: #4d5055}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000; min-height: 16.0px}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #18702b; -webkit-text-stroke: #18702b}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0e6e6d; -webkit-text-stroke: #0e6e6d}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #18702b; -webkit-text-stroke: #18702b; min-height: 16.0px}
    span.s1 {font-kerning: none; background-color: #ecf1f7}
    span.s2 {font-kerning: none; color: #fb0007; background-color: #ecf1f7; -webkit-text-stroke: 0px #fb0007}
    span.s3 {font-kerning: none; color: #2a2a2a; background-color: #ecf1f7; -webkit-text-stroke: 0px #2a2a2a}
    span.s4 {font-kerning: none; color: #000000; background-color: #ecf1f7; -webkit-text-stroke: 0px #000000}
    span.s5 {font-kerning: none; color: #0000ff; background-color: #ecf1f7; -webkit-text-stroke: 0px #0000ff}
    span.s6 {font-kerning: none; color: #6b0001; background-color: #ecf1f7; -webkit-text-stroke: 0px #6b0001}
    span.s7 {font-kerning: none; color: #6f0ec3; background-color: #ecf1f7; -webkit-text-stroke: 0px #6f0ec3}
    span.s8 {font-kerning: none; color: #18702b; background-color: #ecf1f7; -webkit-text-stroke: 0px #18702b}
    span.s9 {font-kerning: none; color: #0e6e6d; background-color: #ecf1f7; -webkit-text-stroke: 0px #0e6e6d}
    span.s10 {font-kerning: none}
    span.s11 {font-kerning: none; color: #a4450b; background-color: #ecf1f7; -webkit-text-stroke: 0px #a4450b}
    span.s12 {font-kerning: none; color: #4d5055; background-color: #ecf1f7; -webkit-text-stroke: 0px #4d5055}
    span.s13 {font-kerning: none; color: #bf1c25; background-color: #ecf1f7; -webkit-text-stroke: 0px #bf1c25}
    span.s14 {font-kerning: none; color: #093c94; background-color: #ecf1f7; -webkit-text-stroke: 0px #093c94}
    span.s15 {font-kerning: none; color: #137646; background-color: #ecf1f7; -webkit-text-stroke: 0px #137646}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"en"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">Premier League Predictor League</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- SEO and Social Tags --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"description"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"Join the Premier League Predictor League! Sign up, make your weekly score predictions, and climb the public leaderboard."</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">property</span><span class="s3">=</span><span class="s1">"og:title"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"Premier League Predictor League"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">property</span><span class="s3">=</span><span class="s1">"og:type"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"website"</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Load Tailwind CSS from CDN --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Load Inter Font from CDN --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&amp;display=swap"</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"stylesheet"</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Firebase SDKs are loaded via CDN for a single-file build --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"module"</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s4"> { initializeApp } </span><span class="s7">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> {<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>getAuth,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>signInAnonymously,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>signInWithCustomToken,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>onAuthStateChanged,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>setPersistence,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>inMemoryPersistence</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span>} </span><span class="s7">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> {<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>getFirestore,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>doc,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>getDoc,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>setDoc,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>onSnapshot,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>collection,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>query,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>where,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>getDocs,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>setLogLevel</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span>} </span><span class="s7">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"</span><span class="s4">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Core App Setup: Variables injected by the Canvas Environment ---</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Global variables provided by the environment</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> appId = </span><span class="s7">typeof</span><span class="s1"> __app_id !== </span><span class="s8">'undefined'</span><span class="s1"> ? __app_id : </span><span class="s8">'default-app-id'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> firebaseConfig = </span><span class="s7">typeof</span><span class="s1"> __firebase_config !== </span><span class="s8">'undefined'</span><span class="s1"> ? </span><span class="s9">JSON</span><span class="s1">.parse(__firebase_config) : {};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> initialAuthToken = </span><span class="s7">typeof</span><span class="s1"> __initial_auth_token !== </span><span class="s8">'undefined'</span><span class="s1"> ? __initial_auth_token : </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Initialize Firebase services</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> app, db, auth;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s4"> userId = </span><span class="s7">null</span><span class="s4">; </span><span class="s1">// The ID of the currently loaded/authenticated user<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> teamName = </span><span class="s8">"Loading..."</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> isAuthChecked = </span><span class="s7">false</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Set Firestore debug logging</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// setLogLevel('debug'); // Uncomment for console debugging</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>app = initializeApp(firebaseConfig);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>db = getFirestore(app);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>auth = getAuth(app);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Set persistence to in-memory to prevent unexpected session restoration issues</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>setPersistence(auth, inMemoryPersistence);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span>console.error(</span><span class="s1">"Firebase Initialization Error:"</span><span class="s4">, e);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Non-breaking error message for the user</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span>document.getElementById(</span><span class="s1">'message-box'</span><span class="s4">).innerHTML = </span><span class="s1">'Error initializing Firebase. Check console.'</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById(</span><span class="s8">'message-box'</span><span class="s1">).classList.add(</span><span class="s8">'bg-red-500'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Constants &amp; Global State ---</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// NOTE: This should be updated by an Admin feature in a real app, but is hardcoded for demo.</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">CURRENT_GAME_WEEK</span><span class="s4"> = </span><span class="s11">14</span><span class="s4">;<span class="Apple-converted-space"> </span></span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">GW_ID</span><span class="s4"> = </span><span class="s8">`GW_</span><span class="s4">${</span><span class="s1">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s8">`</span><span class="s4">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Full list of Premier League teams for admin use</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">PREMIER_LEAGUE_TEAMS</span><span class="s4"> = [</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">'Arsenal'</span><span class="s4">, </span><span class="s1">'Aston Villa'</span><span class="s4">, </span><span class="s1">'Bournemouth'</span><span class="s4">, </span><span class="s1">'Brentford'</span><span class="s4">, </span><span class="s1">'Brighton &amp; Hove Albion'</span><span class="s4">,</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">'Chelsea'</span><span class="s4">, </span><span class="s1">'Crystal Palace'</span><span class="s4">, </span><span class="s1">'Everton'</span><span class="s4">, </span><span class="s1">'Fulham'</span><span class="s4">, </span><span class="s1">'Liverpool'</span><span class="s4">, </span><span class="s1">'Luton Town'</span><span class="s4">,</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">'Manchester City'</span><span class="s4">, </span><span class="s1">'Manchester United'</span><span class="s4">, </span><span class="s1">'Newcastle United'</span><span class="s4">, </span><span class="s1">'Nottingham Forest'</span><span class="s4">,</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">'Sheffield United'</span><span class="s4">, </span><span class="s1">'Tottenham Hotspur'</span><span class="s4">, </span><span class="s1">'West Ham United'</span><span class="s4">, </span><span class="s1">'Wolverhampton Wanderers'</span><span class="s4">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">'Burnley'</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>].sort();</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Fixtures for the current GW (hardcoded for now)</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">CURRENT_FIXTURES</span><span class="s4"> = [</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>{ home: </span><span class="s8">'Arsenal'</span><span class="s1">, away: </span><span class="s8">'Chelsea'</span><span class="s1">, id: </span><span class="s8">'match_1'</span><span class="s1"> },</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span>{ home: </span><span class="s1">'Liverpool'</span><span class="s4">, away: </span><span class="s1">'Manchester United'</span><span class="s4">, id: </span><span class="s1">'match_2'</span><span class="s4"> },</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span>{ home: </span><span class="s1">'Aston Villa'</span><span class="s4">, away: </span><span class="s1">'Newcastle United'</span><span class="s4">, id: </span><span class="s1">'match_3'</span><span class="s4"> },</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span>{ home: </span><span class="s1">'Tottenham Hotspur'</span><span class="s4">, away: </span><span class="s1">'Manchester City'</span><span class="s4">, id: </span><span class="s1">'match_4'</span><span class="s4"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>{ home: </span><span class="s8">'West Ham United'</span><span class="s1">, away: </span><span class="s8">'Fulham'</span><span class="s1">, id: </span><span class="s8">'match_5'</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>{ home: </span><span class="s8">'Everton'</span><span class="s1">, away: </span><span class="s8">'Nottingham Forest'</span><span class="s1">, id: </span><span class="s8">'match_6'</span><span class="s1"> },</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span>{ home: </span><span class="s1">'Brighton &amp; Hove Albion'</span><span class="s4">, away: </span><span class="s1">'Bournemouth'</span><span class="s4">, id: </span><span class="s1">'match_7'</span><span class="s4"> },</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span>{ home: </span><span class="s1">'Crystal Palace'</span><span class="s4">, away: </span><span class="s1">'Wolverhampton Wanderers'</span><span class="s4">, id: </span><span class="s1">'match_8'</span><span class="s4"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>{ home: </span><span class="s8">'Burnley'</span><span class="s1">, away: </span><span class="s8">'Sheffield United'</span><span class="s1">, id: </span><span class="s8">'match_9'</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>{ home: </span><span class="s8">'Luton Town'</span><span class="s1">, away: </span><span class="s8">'Brentford'</span><span class="s1">, id: </span><span class="s8">'match_10'</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>];</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> userPredictions = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> actualResults = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> leaderboardData = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> userProfile = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// 'loading', 'auth-choice', 'signup', 'signin', 'user', 'admin'</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> mainView = </span><span class="s8">'loading'</span><span class="s1">;<span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Utility Functions ---</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> getUserId = () =&gt; userId;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> showMessage = (msg, style = </span><span class="s8">'bg-brand-violet'</span><span class="s1">) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> box = document.getElementById(</span><span class="s8">'message-box'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>box.textContent = msg;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Remove previous classes and ensure p-3 is present for height</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span>box.className = </span><span class="s1">`p-3 rounded-lg text-white text-center transition-opacity duration-300 mb-4 </span><span class="s4">${style}</span><span class="s1"> opacity-100`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>box.classList.remove(</span><span class="s8">'opacity-100'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>box.classList.add(</span><span class="s8">'opacity-0'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}, </span><span class="s11">5000</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Firestore Path Definitions</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> getPredictionsDocRef = (uid) =&gt; doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${uid}</span><span class="s8">/predictions`</span><span class="s1">, </span><span class="s9">GW_ID</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> getProfileDocRef = (uid) =&gt; doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${uid}</span><span class="s8">/profile`</span><span class="s1">, </span><span class="s8">'user_data'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> getResultsDocRef = (gwId = </span><span class="s9">GW_ID</span><span class="s1">) =&gt; doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/public/data/gameweeks`</span><span class="s1">, gwId);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> getLeaderboardColRef = () =&gt; collection(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/public/data/leaderboard`</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> getFixturesDocRef = (gwId) =&gt; doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/public/data/fixtures`</span><span class="s1">, gwId);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> calculatePoints = (predictedHome, predictedAway, actualHome, actualAway) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> pHome = </span><span class="s9">Number</span><span class="s1">(predictedHome);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> pAway = </span><span class="s9">Number</span><span class="s1">(predictedAway);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> aHome = </span><span class="s9">Number</span><span class="s1">(actualHome);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> aAway = </span><span class="s9">Number</span><span class="s1">(actualAway);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (isNaN(pHome) || isNaN(pAway) || isNaN(aHome) || isNaN(aAway)) </span><span class="s7">return</span><span class="s1"> </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> predictedDiff = pHome - pAway;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> actualDiff = aHome - aAway;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> totalActualGoals = aHome + aAway;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> points = </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// 5 pts: Correct Score</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (pHome === aHome &amp;&amp; pAway === aAway) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>points = totalActualGoals &gt;= </span><span class="s11">6</span><span class="s1"> ? </span><span class="s11">10</span><span class="s1"> : </span><span class="s11">5</span><span class="s1">; </span><span class="s12">// Bonus for high-scoring match</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> actualOutcome = </span><span class="s9">Math</span><span class="s1">.sign(actualDiff); </span><span class="s12">// 1 (Home Win), -1 (Away Win), 0 (Draw)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> predictedOutcome = </span><span class="s9">Math</span><span class="s1">.sign(predictedDiff);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 2 pts: Correct Outcome</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (actualOutcome === predictedOutcome) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>points = </span><span class="s11">2</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> points;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> calculateTotalScore = (predictions, actuals) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> totalPoints = </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (actuals &amp;&amp; actuals.matches) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>predictions.forEach(p =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> result = actuals.matches.find(m =&gt; m.id === p.id);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (result) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> points = calculatePoints(p.homePred, p.awayPred, result.homeScore, result.awayScore);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>totalPoints += points;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> totalPoints;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Function to toggle between user and admin view</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>window.toggleAdminMode = () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>mainView = mainView === </span><span class="s8">'user'</span><span class="s1"> ? </span><span class="s8">'admin'</span><span class="s1"> : </span><span class="s8">'user'</span><span class="s1">;<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>updateUI();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>window.navigateTo = (view) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>mainView = view;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>updateUI();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Renderer Functions (HTML Generation) ---</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> renderAuthChoiceView = () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>document.getElementById(</span><span class="s8">'app-content'</span><span class="s1">).innerHTML = </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="max-w-md mx-auto p-8 bg-white rounded-xl shadow-2xl border-t-4 border-brand-dark space-y-6"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-3xl font-extrabold text-brand-dark mb-4 text-center"&gt;Predictor League Access&lt;/h2&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-gray-600 text-center"&gt;Choose your access method to the league.&lt;/p&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="window.navigateTo('signin')" class="w-full py-4 bg-brand-violet text-white font-semibold rounded-lg shadow-md hover:bg-brand-violet-hover transition duration-300 text-lg"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>Sign In (Existing User)</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex-grow border-t border-gray-300"&gt;&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;span class="flex-shrink mx-4 text-gray-500"&gt;OR&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex-grow border-t border-gray-300"&gt;&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="window.navigateTo('signup')" class="w-full py-4 bg-brand-pink text-white font-semibold rounded-lg shadow-md hover:bg-brand-pink-hover transition duration-300 text-lg"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>Create New Account (First Time)</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">             </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>document.getElementById(</span><span class="s8">'app-content'</span><span class="s1">).classList.remove(</span><span class="s8">'h-20'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> renderSignInView = () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>document.getElementById(</span><span class="s8">'app-content'</span><span class="s1">).innerHTML = </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="signin-container" class="max-w-lg mx-auto p-8 bg-white rounded-xl shadow-2xl border-t-4 border-brand-violet"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-3xl font-extrabold text-brand-violet mb-4 text-center"&gt;Sign In&lt;/h2&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-gray-600 mb-6 text-center"&gt;Enter your Team Name and PIN to access your predictions.&lt;/p&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;form id="signin-form" class="space-y-4"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label for="signinTeamName" class="block text-sm font-bold text-brand-dark"&gt;Team Name&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input id="signinTeamName" name="signinTeamName" type="text" placeholder="Your registered team name" required</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>class="mt-1 block w-full border-2 border-brand-dark rounded-md shadow-md p-3 focus:ring-brand-violet focus:border-brand-violet" /&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label for="signinPin" class="block text-sm font-bold text-brand-dark"&gt;PIN/Password&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input id="signinPin" name="signinPin" type="password" placeholder="4-digit PIN (e.g., 1234)" required pattern="\\d{4}" maxlength="4"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>class="mt-1 block w-full border-2 border-brand-dark rounded-md shadow-md p-3 focus:ring-brand-violet focus:border-brand-violet"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button type="submit" class="mt-8 w-full py-3 bg-brand-violet text-white font-semibold rounded-lg shadow-xl hover:bg-brand-violet-hover transition duration-300"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>Login to Account</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/form&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-center mt-4"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onclick="window.navigateTo('auth-choice')" class="text-sm text-gray-500 hover:text-brand-dark underline"&gt;Back to choices&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/p&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">             </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>document.getElementById(</span><span class="s8">'signin-form'</span><span class="s1">).addEventListener(</span><span class="s8">'submit'</span><span class="s1">, (e) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>e.preventDefault();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>handleSignIn();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> renderSignUpView = () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById(</span><span class="s8">'app-content'</span><span class="s1">).innerHTML = </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="signup-container" class="max-w-lg mx-auto p-8 bg-white rounded-xl shadow-2xl border-t-4 border-brand-pink"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-3xl font-extrabold text-brand-pink mb-4 text-center"&gt;Create Your Profile&lt;/h2&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-gray-600 mb-6 text-center"&gt;Set up your team name and a secret PIN for future sign-ins.&lt;/p&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;form id="signup-form" class="space-y-4"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;!-- Public Field --&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label for="teamName" class="block text-sm font-bold text-brand-dark"&gt;Team Name (Public)&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input id="teamName" name="teamName" type="text" placeholder="e.g., The Purple Predictors" required</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>class="mt-1 block w-full border-2 border-brand-dark rounded-md shadow-md p-3 focus:ring-brand-violet focus:border-brand-violet" maxlength="30"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-xs text-gray-500 mt-1"&gt;This name is shown on the leaderboard and used for login.&lt;/p&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;!-- Private Fields --&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label for="pinCode" class="block text-sm font-bold text-brand-dark"&gt;Set 4-Digit PIN/Password&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input id="pinCode" name="pinCode" type="password" placeholder="Set a 4-digit PIN (e.g., 1234)" required pattern="\\d{4}" maxlength="4"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>class="mt-1 block w-full border-2 border-brand-dark rounded-md shadow-md p-3 focus:ring-brand-violet focus:border-brand-violet"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-xs text-gray-500 mt-1 text-brand-pink"&gt;IMPORTANT: You will need this PIN to sign in later.&lt;/p&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h3 class="text-lg font-semibold text-gray-700 pt-4 border-t"&gt;Private Information (Optional)&lt;/h3&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label for="firstName" class="block text-sm font-medium text-gray-700"&gt;First Name&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input id="firstName" name="firstName" type="text"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-brand-dark focus:border-brand-dark"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label for="email" class="block text-sm font-medium text-gray-700"&gt;Email Address (Optional)&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input id="email" name="email" type="email"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-brand-dark focus:border-brand-dark"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button type="submit" class="mt-8 w-full py-3 bg-brand-dark text-white font-semibold rounded-lg shadow-xl hover:bg-brand-dark-hover transition duration-300"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>Register My Team</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/form&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-center mt-4"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onclick="window.navigateTo('auth-choice')" class="text-sm text-gray-500 hover:text-brand-dark underline"&gt;Back to choices&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/p&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById(</span><span class="s8">'signup-form'</span><span class="s1">).addEventListener(</span><span class="s8">'submit'</span><span class="s1">, (e) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>e.preventDefault();</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Pass the current anonymous ID for initial signup</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>handleProfileSave(</span><span class="s7">true</span><span class="s1">, auth.currentUser.uid);<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> renderAdminView = () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> content = document.getElementById(</span><span class="s8">'app-content'</span><span class="s1">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Generate options for the team dropdowns</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> teamOptions = </span><span class="s9">PREMIER_LEAGUE_TEAMS</span><span class="s1">.map(team =&gt; </span><span class="s8">`&lt;option value="</span><span class="s1">${team}</span><span class="s8">"&gt;</span><span class="s1">${team}</span><span class="s8">&lt;/option&gt;`</span><span class="s1">).join(</span><span class="s8">''</span><span class="s1">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>content.innerHTML = </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="admin-view-container" class="max-w-2xl mx-auto space-y-8"&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- 1. Publish Actual Results Section --&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="p-6 rounded-xl shadow-lg bg-orange-50 border-4 border-orange-400"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h2 class="text-3xl font-extrabold text-orange-800 mb-2"&gt;✅ Publish GW </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s1"> Results&lt;/h2&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-orange-700 mb-6"&gt;Enter the **ACTUAL** final scores below for Game Week </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s1">.&lt;/p&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;form id="admin-results-form" class="space-y-3 mb-6"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s4">${</span><span class="s9">CURRENT_FIXTURES</span><span class="s4">.map(f =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">const</span><span class="s1"> result = actualResults?.matches?.find(m =&gt; m.id === f.id) || { homeScore: </span><span class="s8">''</span><span class="s1">, awayScore: </span><span class="s8">''</span><span class="s1"> };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">return</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;div class="flex items-center justify-between p-3 bg-gray-100 rounded-lg shadow-sm border border-orange-200"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;span class="w-1/3 text-left font-medium truncate"&gt;</span><span class="s4">${f.home}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;div class="flex items-center space-x-2 w-1/3 justify-center"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;input id="admin_score_</span><span class="s4">${f.id}</span><span class="s1">_home" name="admin_score_</span><span class="s4">${f.id}</span><span class="s1">_home" type="number" min="0" value="</span><span class="s4">${result.homeScore}</span><span class="s1">"<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>class="w-12 text-center border rounded-md p-1 bg-white border-orange-500 focus:ring-brand-pink focus:border-brand-pink"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;span class="font-bold text-lg"&gt;-&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;input id="admin_score_</span><span class="s4">${f.id}</span><span class="s1">_away" name="admin_score_</span><span class="s4">${f.id}</span><span class="s1">_away" type="number" min="0" value="</span><span class="s4">${result.awayScore}</span><span class="s1">"<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>class="w-12 text-center border rounded-md p-1 bg-white border-orange-500 focus:ring-brand-pink focus:border-brand-pink"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;span class="w-1/3 text-right font-medium truncate"&gt;</span><span class="s4">${f.away}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>}).join(</span><span class="s8">''</span><span class="s1">)}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/form&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="publish-results-btn" class="w-full py-3 bg-brand-pink text-white font-semibold rounded-lg shadow-xl hover:bg-brand-pink-hover transition duration-300"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>Publish Official GW </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s1"> Results</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- 2. Populate Upcoming Fixtures Section --&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="p-6 rounded-xl shadow-lg bg-blue-50 border-4 border-blue-400 mt-8"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h2 class="text-3xl font-extrabold text-blue-800 mb-2"&gt;➕ Populate Upcoming GW Fixtures&lt;/h2&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-blue-700 mb-4"&gt;Select the target Game Week and define the 10 fixtures. (All 20 teams must be used once).&lt;/p&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;label for="target-gw" class="block text-sm font-bold text-blue-800 mb-2"&gt;Target Game Week Number (must be &gt; </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s1">)&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;input id="target-gw" type="number" min="</span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4"> + </span><span class="s11">1</span><span class="s4">}</span><span class="s1">" value="</span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4"> + </span><span class="s11">1</span><span class="s4">}</span><span class="s1">"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>class="w-full mb-6 text-center border-2 border-blue-500 rounded-md p-2 focus:ring-brand-violet focus:border-brand-violet" /&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;form id="admin-fixture-form" class="space-y-3"&gt;</span></p>
<p class="p5"><span class="s8"><span class="Apple-converted-space">                            </span></span><span class="s1">${</span><span class="s9">Array</span><span class="s1">(</span><span class="s11">10</span><span class="s1">).fill(</span><span class="s11">0</span><span class="s1">).map((_, index) =&gt; </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;div class="flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200 shadow-sm"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;select id="fixture_</span><span class="s4">${index}</span><span class="s1">_home" data-match-index="</span><span class="s4">${index}</span><span class="s1">" data-team-type="home" required</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>class="w-5/12 border rounded-md p-2 focus:ring-brand-violet focus:border-brand-violet team-select home-team"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;option value="" disabled selected&gt;-- Select Home --&lt;/option&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span></span><span class="s4">${teamOptions}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;/select&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;span class="font-bold text-lg text-blue-700"&gt;vs&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;select id="fixture_</span><span class="s4">${index}</span><span class="s1">_away" data-match-index="</span><span class="s4">${index}</span><span class="s1">" data-team-type="away" required</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>class="w-5/12 border rounded-md p-2 focus:ring-brand-violet focus:border-brand-violet team-select away-team"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;option value="" disabled selected&gt;-- Select Away --&lt;/option&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span></span><span class="s4">${teamOptions}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;/select&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>`</span><span class="s4">).join(</span><span class="s1">''</span><span class="s4">)}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/form&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="publish-fixtures-btn" class="w-full mt-6 py-3 bg-brand-violet text-white font-semibold rounded-lg shadow-xl hover:bg-brand-violet-hover transition duration-300"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>Publish GW Fixtures</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById(</span><span class="s8">'publish-results-btn'</span><span class="s1">).addEventListener(</span><span class="s8">'click'</span><span class="s1">, updateActualResults);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById(</span><span class="s8">'publish-fixtures-btn'</span><span class="s1">).addEventListener(</span><span class="s8">'click'</span><span class="s1">, saveUpcomingFixtures);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> renderMainApp = (currentTab = </span><span class="s8">'predictions'</span><span class="s1">) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> currentTotalScore = leaderboardData.find(s =&gt; s.userId === getUserId())?.totalScore || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> appContent = document.getElementById(</span><span class="s8">'app-content'</span><span class="s1">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// 1. Render Tabs</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>appContent.innerHTML = </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="user-main-container" class="lg:max-w-3xl mx-auto"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex border-b border-gray-200 mb-6 bg-white rounded-t-xl shadow-md overflow-hidden"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button data-tab="predictions" class="tab-button flex-1 py-3 text-lg font-semibold transition duration-150"&gt;Predictions&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button data-tab="leaderboard" class="tab-button flex-1 py-3 text-lg font-semibold transition duration-150"&gt;Leaderboard&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button data-tab="profile" class="tab-button flex-1 py-3 text-lg font-semibold transition duration-150"&gt;Profile&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div id="tab-content"&gt;&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById(</span><span class="s8">'app-content'</span><span class="s1">).classList.remove(</span><span class="s8">'h-20'</span><span class="s1">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Add event listeners for tab switching</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.querySelectorAll(</span><span class="s8">'.tab-button'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>button.addEventListener(</span><span class="s8">'click'</span><span class="s1">, (e) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>renderMainApp(e.currentTarget.dataset.tab);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Set active tab style</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.querySelectorAll(</span><span class="s8">'.tab-button'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>button.classList.remove(</span><span class="s1">'active'</span><span class="s4">, </span><span class="s1">'border-b-brand-violet'</span><span class="s4">, </span><span class="s1">'text-brand-violet'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>button.classList.add(</span><span class="s8">'text-gray-500'</span><span class="s1">, </span><span class="s8">'hover:text-brand-violet'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (button.dataset.tab === currentTab) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                    </span>button.classList.add(</span><span class="s1">'active'</span><span class="s4">, </span><span class="s1">'border-b-brand-violet'</span><span class="s4">, </span><span class="s1">'text-brand-violet'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.classList.remove(</span><span class="s8">'text-gray-500'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> tabContent = document.getElementById(</span><span class="s8">'tab-content'</span><span class="s1">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// 2. Render Tab Content</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (currentTab === </span><span class="s8">'predictions'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>tabContent.innerHTML = </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div id="predictions-tab-content" class="p-6 bg-white rounded-xl shadow-lg"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h2 class="text-2xl font-bold text-gray-800 border-b pb-3 mb-4 flex justify-between items-center"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>Game Week </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s1"> Fixtures</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="text-sm font-normal text-brand-violet"&gt;Total Score: &lt;span class="text-2xl font-extrabold"&gt;</span><span class="s4">${currentTotalScore}</span><span class="s1">&lt;/span&gt;&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/h2&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div id="predictions-form" class="space-y-3"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s4">${</span><span class="s9">CURRENT_FIXTURES</span><span class="s4">.map(f =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">const</span><span class="s1"> prediction = userPredictions.find(p =&gt; p.id === f.id) || { homePred: </span><span class="s11">0</span><span class="s1">, awayPred: </span><span class="s11">0</span><span class="s1"> };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">const</span><span class="s1"> result = actualResults?.matches?.find(m =&gt; m.id === f.id);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">let</span><span class="s1"> points = </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">if</span><span class="s1"> (result) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>points = calculatePoints(prediction.homePred, prediction.awayPred, result.homeScore, result.awayScore);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">const</span><span class="s1"> inputHidden = !!result;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">const</span><span class="s1"> pointsClass = points === </span><span class="s11">0</span><span class="s1"> ? </span><span class="s8">'text-gray-500'</span><span class="s1"> : (points &gt;= </span><span class="s11">5</span><span class="s1"> ? </span><span class="s8">'text-brand-pink'</span><span class="s1"> : </span><span class="s8">'text-brand-violet'</span><span class="s1">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">return</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg shadow-sm"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;span class="w-1/3 text-left font-medium truncate"&gt;</span><span class="s4">${f.home}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;div class="flex items-center space-x-2 w-1/3 justify-center"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;input<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>type="number" min="0"<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>value="</span><span class="s4">${prediction.homePred || </span><span class="s11">0</span><span class="s4">}</span><span class="s1">"<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>data-match-id="</span><span class="s4">${f.id}</span><span class="s1">" data-field="homePred"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>oninput="window.handlePredictionChange('</span><span class="s4">${f.id}</span><span class="s1">', 'homePred', this.value)"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>class="w-12 text-center border rounded-md p-1 focus:ring-brand-dark focus:border-brand-dark </span><span class="s4">${inputHidden ? </span><span class="s1">'hidden'</span><span class="s4"> : </span><span class="s1">'inline-block'</span><span class="s4">}</span><span class="s1">"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;span class="</span><span class="s4">${inputHidden ? </span><span class="s1">'hidden'</span><span class="s4"> : </span><span class="s1">'inline-block'</span><span class="s4">}</span><span class="s1">"&gt;-&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;input<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>type="number" min="0"<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>value="</span><span class="s4">${prediction.awayPred || </span><span class="s11">0</span><span class="s4">}</span><span class="s1">"<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>data-match-id="</span><span class="s4">${f.id}</span><span class="s1">" data-field="awayPred"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>oninput="window.handlePredictionChange('</span><span class="s4">${f.id}</span><span class="s1">', 'awayPred', this.value)"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>class="w-12 text-center border rounded-md p-1 focus:ring-brand-dark focus:border-brand-dark </span><span class="s4">${inputHidden ? </span><span class="s1">'hidden'</span><span class="s4"> : </span><span class="s1">'inline-block'</span><span class="s4">}</span><span class="s1">"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span></span><span class="s4">${result ?<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                                                </span></span><span class="s1">`&lt;span class="text-base font-bold text-gray-700"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                    </span></span><span class="s4">${result.homeScore}</span><span class="s1"> - </span><span class="s4">${result.awayScore}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>&lt;/span&gt;`</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                                </span>: </span><span class="s8">''</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                            </span>}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;span class="w-1/3 text-right font-medium flex justify-end items-center space-x-2"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span></span><span class="s4">${result ?<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                                </span></span><span class="s8">`&lt;span class="text-sm font-semibold </span><span class="s1">${pointsClass}</span><span class="s8">"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                    </span></span><span class="s4">${points}</span><span class="s1"> pts</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>&lt;/span&gt;`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                                </span>: </span><span class="s8">''</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                            </span>}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;span class="truncate"&gt;</span><span class="s4">${f.away}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>}).join(</span><span class="s8">''</span><span class="s1">)}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="save-predictions-btn" class="mt-6 w-full py-3 bg-brand-pink text-white font-semibold rounded-lg shadow-md hover:bg-brand-pink-hover transition duration-300"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>Save Predictions for GW </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-xs text-gray-500 mt-2 text-center"&gt;Your predictions are saved in real-time to the cloud.&lt;/p&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="mt-6 p-4 bg-brand-dark/5 rounded-lg border border-brand-dark/20"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;h3 class="font-bold text-brand-dark mb-1"&gt;Scoring Rules:&lt;/h3&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;ul class="text-sm text-brand-dark list-disc list-inside"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;li&gt;&lt;span class="font-bold"&gt;5 pts:&lt;/span&gt; Correct Score (e.g., predicted 2-1, actual 2-1)&lt;/li&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;li&gt;&lt;span class="font-bold"&gt;10 pts:&lt;/span&gt; Correct Score for '6-Goal Thriller' (Total goals </span><span class="s13">$</span><span class="s1">\ge 6</span><span class="s13">$</span><span class="s1">)&lt;/li&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;li&gt;&lt;span class="font-bold"&gt;2 pts:&lt;/span&gt; Correct Outcome (Winner or Draw)&lt;/li&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/ul&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.getElementById(</span><span class="s8">'save-predictions-btn'</span><span class="s1">).addEventListener(</span><span class="s8">'click'</span><span class="s1">, savePredictions);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (currentTab === </span><span class="s8">'leaderboard'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>tabContent.innerHTML = </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div id="leaderboard-tab-content" class="p-6 bg-white rounded-xl shadow-lg"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h2 class="text-2xl font-bold text-gray-800 border-b pb-3 mb-4"&gt;Current Leaderboard (GW </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s1">)&lt;/h2&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;ul id="leaderboard-list" class="space-y-3"&gt;</span></p>
<p class="p5"><span class="s8"><span class="Apple-converted-space">                            </span></span><span class="s1">${leaderboardData.length === </span><span class="s11">0</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                                </span>? </span><span class="s1">'&lt;li class="text-gray-500 text-center p-4"&gt;Loading scores...&lt;/li&gt;'</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>: leaderboardData.map((score, index) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span></span><span class="s7">const</span><span class="s1"> currentUid = getUserId();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span></span><span class="s7">const</span><span class="s1"> isCurrentUser = score.userId === currentUid;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span></span><span class="s7">const</span><span class="s1"> displayTeamName = score.teamName || (score.userId ? </span><span class="s8">`</span><span class="s1">${score.userId.substring(</span><span class="s11">0</span><span class="s1">, </span><span class="s11">8</span><span class="s1">)}</span><span class="s8">...`</span><span class="s1"> : </span><span class="s8">'Unknown User'</span><span class="s1">);<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span></span><span class="s7">return</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;li class="flex justify-between items-center p-3 rounded-lg </span><span class="s4">${isCurrentUser ? </span><span class="s1">'bg-brand-dark/10 font-bold border-2 border-brand-dark'</span><span class="s4"> : </span><span class="s1">'bg-white shadow'</span><span class="s4">}</span><span class="s1">"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;div class="flex items-center space-x-3 w-3/4 truncate"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>&lt;span class="text-xl w-6 text-center"&gt;</span><span class="s4">${index + </span><span class="s11">1</span><span class="s4">}</span><span class="s1">.&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                                </span>&lt;span class="truncate"&gt;</span><span class="s4">${isCurrentUser ? </span><span class="s1">'You ('</span><span class="s4"> + displayTeamName + </span><span class="s1">')'</span><span class="s4"> : displayTeamName}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;span class="text-2xl text-brand-dark"&gt;</span><span class="s4">${score.totalScore || </span><span class="s11">0</span><span class="s4">}</span><span class="s1"> pts&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;/li&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>}).join(</span><span class="s8">''</span><span class="s1">)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/ul&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (currentTab === </span><span class="s8">'profile'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>tabContent.innerHTML = </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div id="profile-tab-content" class="p-6 bg-white rounded-xl shadow-lg"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h3 class="text-xl font-semibold text-brand-dark mb-4"&gt;Your Profile Details&lt;/h3&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s4">${!userProfile ? </span><span class="s1">'&lt;p class="text-center text-gray-500"&gt;Loading profile...&lt;/p&gt;'</span><span class="s4"> : </span><span class="s1">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;form id="profile-edit-form" class="space-y-4"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;label for="teamName" class="block text-sm font-bold text-brand-dark"&gt;Team Name (Public)&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;input id="teamName" name="teamName" type="text" value="</span><span class="s4">${userProfile.teamName || </span><span class="s1">''</span><span class="s4">}</span><span class="s1">"<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-brand-violet focus:border-brand-violet" maxlength="30"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;p class="text-xs text-gray-500 mt-1"&gt;This name is visible on the public leaderboard.&lt;/p&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;label for="pinCode" class="block text-sm font-bold text-brand-dark"&gt;PIN/Password&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;input id="pinCode" name="pinCode" type="password" placeholder="Enter new 4-digit PIN (optional)" pattern="\\d{4}" maxlength="4"</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-brand-violet focus:border-brand-violet"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;p class="text-xs text-gray-500 mt-1"&gt;Leave blank to keep current PIN.&lt;/p&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;div class="grid grid-cols-1 sm:grid-cols-2 gap-4"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;label for="firstName" class="block text-sm font-medium text-gray-700"&gt;First Name (Private)&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;input id="firstName" name="firstName" type="text" value="</span><span class="s4">${userProfile.firstName || </span><span class="s1">''</span><span class="s4">}</span><span class="s1">"<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-brand-dark focus:border-brand-dark"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                                    </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;label for="email" class="block text-sm font-medium text-gray-700"&gt;Email (Private)&lt;/label&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;input id="email" name="email" type="email" value="</span><span class="s4">${userProfile.email || </span><span class="s1">''</span><span class="s4">}</span><span class="s1">"<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                            </span>class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-brand-dark focus:border-brand-dark"/&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button type="submit" class="mt-6 w-full py-3 bg-brand-pink text-white font-semibold rounded-lg shadow-md hover:bg-brand-pink-hover transition duration-300"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                    </span>Update Profile</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/button&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/form&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-xs text-gray-500 mt-2 text-center"&gt;Your unique ID: &lt;span class="font-mono text-xs break-all"&gt;</span><span class="s4">${getUserId()}</span><span class="s1">&lt;/span&gt;&lt;/p&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>`</span><span class="s4">}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (userProfile) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>document.getElementById(</span><span class="s8">'profile-edit-form'</span><span class="s1">).addEventListener(</span><span class="s8">'submit'</span><span class="s1">, (e) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>e.preventDefault();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>handleProfileSave(</span><span class="s7">false</span><span class="s1">, getUserId());</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> updateUI = () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> currentUid = getUserId();</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById(</span><span class="s8">'gameweek-info'</span><span class="s1">).textContent = </span><span class="s9">CURRENT_GAME_WEEK</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> statusElement = document.getElementById(</span><span class="s8">'auth-status'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> adminToggleBtn = document.getElementById(</span><span class="s8">'admin-mode-toggle'</span><span class="s1">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (currentUid &amp;&amp; isAuthChecked &amp;&amp; (mainView === </span><span class="s8">'user'</span><span class="s1"> || mainView === </span><span class="s8">'admin'</span><span class="s1">)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>statusElement.innerHTML = </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="font-semibold text-brand-pink"&gt;Signed In&lt;/span&gt; | Team: &lt;span class="text-brand-violet font-bold"&gt;</span><span class="s4">${teamName}</span><span class="s1">&lt;/span&gt; | &lt;span class="text-xs text-gray-500"&gt;ID: </span><span class="s4">${currentUid.substring(</span><span class="s11">0</span><span class="s4">, </span><span class="s11">8</span><span class="s4">)}</span><span class="s1">...&lt;/span&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                 </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>adminToggleBtn.style.display = </span><span class="s8">'inline-block'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>adminToggleBtn.textContent = mainView === </span><span class="s8">'user'</span><span class="s1"> ? </span><span class="s8">'Enable Admin Mode'</span><span class="s1"> : </span><span class="s8">'Exit Admin Mode'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>statusElement.textContent = isAuthChecked ? </span><span class="s8">'Signed Out'</span><span class="s1"> : </span><span class="s8">'Initializing...'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>adminToggleBtn.style.display = </span><span class="s8">'none'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (mainView === </span><span class="s8">'user'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>renderMainApp(document.querySelector(</span><span class="s8">'.tab-button.active'</span><span class="s1">)?.dataset.tab || </span><span class="s8">'predictions'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (mainView === </span><span class="s8">'signup'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>renderSignUpView();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (mainView === </span><span class="s8">'signin'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>renderSignInView();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (mainView === </span><span class="s8">'auth-choice'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>renderAuthChoiceView();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (mainView === </span><span class="s8">'admin'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>renderAdminView();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>document.getElementById(</span><span class="s8">'app-content'</span><span class="s1">).innerHTML = </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;div class="text-center p-12 text-gray-600"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                         </span>&lt;div class="animate-spin rounded-full h-8 w-8 border-b-2 border-brand-violet mx-auto mb-4"&gt;&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                         </span></span><span class="s4">${isAuthChecked ? </span><span class="s1">'Redirecting to login...'</span><span class="s4"> : </span><span class="s1">'Loading application...'</span><span class="s4">}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                 </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>document.getElementById(</span><span class="s8">'app-content'</span><span class="s1">).classList.add(</span><span class="s8">'h-20'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Data Handlers (Logic) ---</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>window.handlePredictionChange = (id, field, value) =&gt; {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Check if results are posted (meaning predictions are locked)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (actualResults) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">`Predictions are locked for GW </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s1"> as official results have been posted.`</span><span class="s4">, </span><span class="s1">'bg-red-500'</span><span class="s4">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Revert the input field to its previous value if possible, or just ignore the change</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> inputElement = document.querySelector(</span><span class="s8">`input[data-match-id="</span><span class="s1">${id}</span><span class="s8">"][data-field="</span><span class="s1">${field}</span><span class="s8">"]`</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (inputElement) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>inputElement.value = userPredictions.find(p =&gt; p.id === id)?.[field] || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> numValue = parseInt(value, </span><span class="s11">10</span><span class="s1">) || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> existingIndex = userPredictions.findIndex(p =&gt; p.id === id);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (existingIndex &gt; -</span><span class="s11">1</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userPredictions[existingIndex][field] = numValue;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> fixture = </span><span class="s9">CURRENT_FIXTURES</span><span class="s1">.find(f =&gt; f.id === id);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userPredictions.push({<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>...fixture,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>homePred: field === </span><span class="s8">'homePred'</span><span class="s1"> ? numValue : (userPredictions.find(p =&gt; p.id === id)?.homePred || </span><span class="s11">0</span><span class="s1">),<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>awayPred: field === </span><span class="s8">'awayPred'</span><span class="s1"> ? numValue : (userPredictions.find(p =&gt; p.id === id)?.awayPred || </span><span class="s11">0</span><span class="s1">),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>[field]: numValue<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>renderMainApp(</span><span class="s8">'predictions'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> savePredictions = </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> currentUid = getUserId();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!currentUid || !db) </span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (actualResults) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">`Cannot save. Predictions are locked for GW </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s1">.`</span><span class="s4">, </span><span class="s1">'bg-red-500'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> predictionData = {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>predictions: userPredictions.map(p =&gt; ({</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>id: p.id,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>homePred: p.homePred,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>awayPred: p.awayPred,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>})),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>timestamp: </span><span class="s7">new</span><span class="s1"> </span><span class="s9">Date</span><span class="s1">().toISOString(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>gameweek: </span><span class="s9">CURRENT_GAME_WEEK</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> isValid = predictionData.predictions.every(p =&gt;<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>p.homePred !== </span><span class="s7">undefined</span><span class="s1"> &amp;&amp; p.awayPred !== </span><span class="s7">undefined</span><span class="s1"> &amp;&amp; p.homePred &gt;= </span><span class="s11">0</span><span class="s1"> &amp;&amp; p.awayPred &gt;= </span><span class="s11">0</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!isValid) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">"Please ensure all score predictions are valid non-negative numbers."</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Ensure we only store the score prediction, not the home/away team names which are fixed in CURRENT_FIXTURES</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">await</span><span class="s1"> setDoc(getPredictionsDocRef(currentUid), predictionData);</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">`Predictions saved successfully for GW </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s1">!`</span><span class="s4">, </span><span class="s1">'bg-brand-violet'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>console.error(</span><span class="s8">"Error saving predictions: "</span><span class="s1">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s8">`Error saving predictions: </span><span class="s1">${e.message}</span><span class="s8">`</span><span class="s1">, </span><span class="s8">'bg-brand-pink'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// New Sign In Logic</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> handleSignIn = </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> form = document.getElementById(</span><span class="s8">'signin-form'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> teamNameInput = form.elements.signinTeamName.value.trim();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> pinCodeInput = form.elements.signinPin.value.trim();</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!teamNameInput || pinCodeInput.length !== </span><span class="s11">4</span><span class="s1">) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                 </span>showMessage(</span><span class="s1">'Please enter a valid Team Name and 4-digit PIN.'</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 1. Query the public leaderboard to find the userId based on Team Name</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> q = query(getLeaderboardColRef(), where(</span><span class="s8">"teamName"</span><span class="s1">, </span><span class="s8">"=="</span><span class="s1">, teamNameInput));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> querySnapshot = </span><span class="s7">await</span><span class="s1"> getDocs(q);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (querySnapshot.empty) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">'Team Name not found. Please check your spelling or sign up.'</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> historicProfile = querySnapshot.docs[</span><span class="s11">0</span><span class="s1">].data();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> historicUserId = historicProfile.userId;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 2. Fetch the full private profile to verify the PIN</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> privateProfileSnap = </span><span class="s7">await</span><span class="s1"> getDoc(getProfileDocRef(historicUserId));</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (!privateProfileSnap.exists()) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">'Profile data missing. Contact administrator.'</span><span class="s4">, </span><span class="s1">'bg-red-500'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> privateProfile = privateProfileSnap.data();</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">// 3. Verify PIN</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (privateProfile.pinCode !== pinCodeInput) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">'Incorrect PIN/Password. Please try again.'</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 4. Success: Switch App Context to the Historic User ID</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Note: We need to sign in with the custom token for the historic user ID to work</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Since we don't have the historic user's token, we'll use the current authenticated user's context (which might be anonymous)</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// For a true multi-user app, this sign-in would require a backend function to generate a token for the historicUserId.</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// For the purposes of this demo, we'll set the context but acknowledge the current `auth.currentUser.uid` might not match `historicUserId`.</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userId = historicUserId;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userProfile = privateProfile;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>teamName = privateProfile.teamName;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>mainView = </span><span class="s8">'user'</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Re-setup listeners for the *historic* userId</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>setupListeners(userId);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s8">`Welcome back, </span><span class="s1">${teamName}</span><span class="s8">!`</span><span class="s1">, </span><span class="s8">'bg-brand-violet'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>updateUI();</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>console.error(</span><span class="s8">"Sign In Error:"</span><span class="s1">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s8">`Sign in failed: </span><span class="s1">${e.message}</span><span class="s8">`</span><span class="s1">, </span><span class="s8">'bg-brand-pink'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> handleProfileSave = </span><span class="s7">async</span><span class="s1"> (isInitialSignup, currentAuthId) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> formId = isInitialSignup ? </span><span class="s8">'signup-form'</span><span class="s1"> : </span><span class="s8">'profile-edit-form'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> form = document.getElementById(formId);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> newTeamName = form.elements.teamName.value.trim();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> newPinCode = form.elements.pinCode.value.trim();</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Determine the target ID for saving<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> targetId = isInitialSignup ? currentAuthId : getUserId();</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!targetId || !db) </span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!newTeamName) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">'Team Name is required.'</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (isInitialSignup &amp;&amp; newPinCode.length !== </span><span class="s11">4</span><span class="s1">) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">'You must set a 4-digit PIN for sign up.'</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!isInitialSignup &amp;&amp; newPinCode.length &gt; </span><span class="s11">0</span><span class="s1"> &amp;&amp; newPinCode.length !== </span><span class="s11">4</span><span class="s1">) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                 </span>showMessage(</span><span class="s1">'New PIN must be exactly 4 digits or left blank.'</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Check if team name is already taken if this is a new signup</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (isInitialSignup) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">const</span><span class="s1"> q = query(getLeaderboardColRef(), where(</span><span class="s8">"teamName"</span><span class="s1">, </span><span class="s8">"=="</span><span class="s1">, newTeamName));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">const</span><span class="s1"> querySnapshot = </span><span class="s7">await</span><span class="s1"> getDocs(q);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">if</span><span class="s1"> (!querySnapshot.empty) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                     </span>showMessage(</span><span class="s1">'Team Name is already taken. Please choose another.'</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Retrieve current totalScore from the global leaderboard data</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> currentLeaderboardEntry = leaderboardData.find(s =&gt; s.userId === targetId);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> totalScore = currentLeaderboardEntry ? currentLeaderboardEntry.totalScore : </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> profileData;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (isInitialSignup) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>profileData = {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>pinCode: newPinCode,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>teamName: newTeamName,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>userId: targetId,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>firstName: form.elements.firstName.value.trim() || </span><span class="s7">null</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>email: form.elements.email.value.trim() || </span><span class="s7">null</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>registeredAt: </span><span class="s7">new</span><span class="s1"> </span><span class="s9">Date</span><span class="s1">().toISOString(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>lastUpdated: </span><span class="s7">new</span><span class="s1"> </span><span class="s9">Date</span><span class="s1">().toISOString(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>profileData = {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>...userProfile,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>teamName: newTeamName,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>firstName: form.elements.firstName.value.trim() || </span><span class="s7">null</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>email: form.elements.email.value.trim() || </span><span class="s7">null</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>lastUpdated: </span><span class="s7">new</span><span class="s1"> </span><span class="s9">Date</span><span class="s1">().toISOString(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>};</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                 </span></span><span class="s1">// Only update PIN if a new one is provided</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">if</span><span class="s1"> (newPinCode.length === </span><span class="s11">4</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>profileData.pinCode = newPinCode;<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 1. Save Profile (Private Data)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">await</span><span class="s1"> setDoc(getProfileDocRef(targetId), profileData);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 2. Update Leaderboard (Public Data - only need teamName and userId)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">await</span><span class="s1"> setDoc(doc(getLeaderboardColRef(), targetId), {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>totalScore: totalScore,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>lastUpdated: </span><span class="s7">new</span><span class="s1"> </span><span class="s9">Date</span><span class="s1">().toISOString(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>gameweek: </span><span class="s9">CURRENT_GAME_WEEK</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>userId: targetId,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>teamName: newTeamName</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}, { merge: </span><span class="s7">true</span><span class="s1"> });</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Update local state</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>teamName = newTeamName;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userProfile = profileData;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userId = targetId;<span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">`Profile for Team '</span><span class="s4">${newTeamName}</span><span class="s1">' saved successfully!`</span><span class="s4">, </span><span class="s1">'bg-brand-violet'</span><span class="s4">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (isInitialSignup) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>mainView = </span><span class="s8">'user'</span><span class="s1">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Re-run the listener setup for the newly registered user</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>setupListeners(targetId);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>updateUI();<span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>console.error(</span><span class="s8">"Error saving profile:"</span><span class="s1">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s8">`Error saving profile: </span><span class="s1">${e.message}</span><span class="s8">`</span><span class="s1">, </span><span class="s8">'bg-brand-pink'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> updateActualResults = </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> currentUid = getUserId();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!currentUid || !db) </span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Only allow updates if we have a registered user (to prevent anonymous users from setting results)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!userProfile) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                 </span>showMessage(</span><span class="s1">"Only registered users (Admins) can set results."</span><span class="s4">, </span><span class="s1">'bg-red-500'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> resultsForm = document.getElementById(</span><span class="s8">'admin-results-form'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> updatedResults = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> isValid = </span><span class="s7">true</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">CURRENT_FIXTURES</span><span class="s1">.forEach(f =&gt; {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Ensure values are retrieved correctly from the form</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> homeInput = resultsForm.elements[</span><span class="s8">`admin_score_</span><span class="s1">${f.id}</span><span class="s8">_home`</span><span class="s1">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> awayInput = resultsForm.elements[</span><span class="s8">`admin_score_</span><span class="s1">${f.id}</span><span class="s8">_away`</span><span class="s1">];</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (!homeInput || !awayInput) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">`Missing input for match </span><span class="s1">${f.id}</span><span class="s8">`</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>isValid = </span><span class="s7">false</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> homeScore = parseInt(homeInput.value, </span><span class="s11">10</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> awayScore = parseInt(awayInput.value, </span><span class="s11">10</span><span class="s1">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (isNaN(homeScore) || isNaN(awayScore) || homeScore &lt; </span><span class="s11">0</span><span class="s1"> || awayScore &lt; </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>isValid = </span><span class="s7">false</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>updatedResults.push({</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>home: f.home,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>away: f.away,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>homeScore: homeScore,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>awayScore: awayScore,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>id: f.id</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!isValid) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">"Please ensure all actual scores are valid non-negative numbers."</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> resultsDocRef = getResultsDocRef(</span><span class="s9">GW_ID</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">await</span><span class="s1"> setDoc(resultsDocRef, {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>gameweek: </span><span class="s9">CURRENT_GAME_WEEK</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>matches: updatedResults,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>updatedAt: </span><span class="s7">new</span><span class="s1"> </span><span class="s9">Date</span><span class="s1">().toISOString()</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">`Official Game Week </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4">}</span><span class="s1"> results published! Leaderboard will update shortly.`</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>console.error(</span><span class="s8">"Error publishing actual results: "</span><span class="s1">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s8">`Error publishing results: </span><span class="s1">${e.message}</span><span class="s8">`</span><span class="s1">, </span><span class="s8">'bg-brand-pink'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> saveUpcomingFixtures = </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">             </span></span><span class="s1">// Admin protection check</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!userProfile) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                 </span>showMessage(</span><span class="s1">"Only registered users (Admins) can set fixtures."</span><span class="s4">, </span><span class="s1">'bg-red-500'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> targetGwInput = document.getElementById(</span><span class="s8">'target-gw'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> targetGw = parseInt(targetGwInput.value, </span><span class="s11">10</span><span class="s1">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (isNaN(targetGw) || targetGw &lt;= </span><span class="s9">CURRENT_GAME_WEEK</span><span class="s1"> || targetGw &gt; </span><span class="s11">38</span><span class="s1">) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">`Target Game Week must be a number between </span><span class="s4">${</span><span class="s9">CURRENT_GAME_WEEK</span><span class="s4"> + </span><span class="s11">1</span><span class="s4">}</span><span class="s1"> and 38.`</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> fixtureForm = document.getElementById(</span><span class="s8">'admin-fixture-form'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> newFixtures = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> teamsInvolved = </span><span class="s7">new</span><span class="s1"> </span><span class="s9">Set</span><span class="s1">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> </span><span class="s9">GW_ID_NEW</span><span class="s1"> = </span><span class="s8">`GW_</span><span class="s1">${targetGw}</span><span class="s8">`</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">for</span><span class="s1"> (</span><span class="s7">let</span><span class="s1"> i = </span><span class="s11">0</span><span class="s1">; i &lt; </span><span class="s11">10</span><span class="s1">; i++) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> homeTeam = fixtureForm.elements[</span><span class="s8">`fixture_</span><span class="s1">${i}</span><span class="s8">_home`</span><span class="s1">].value;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> awayTeam = fixtureForm.elements[</span><span class="s8">`fixture_</span><span class="s1">${i}</span><span class="s8">_away`</span><span class="s1">].value;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (!homeTeam || !awayTeam) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">`Match </span><span class="s4">${i + </span><span class="s11">1</span><span class="s4">}</span><span class="s1"> must have both Home and Away teams selected.`</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (homeTeam === awayTeam) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">`Match </span><span class="s4">${i + </span><span class="s11">1</span><span class="s4">}</span><span class="s1">: Home and Away teams cannot be the same.`</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>teamsInvolved.add(homeTeam);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>teamsInvolved.add(awayTeam);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>newFixtures.push({</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>home: homeTeam,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>away: awayTeam,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span>id: </span><span class="s8">`match_</span><span class="s4">${i + </span><span class="s11">1</span><span class="s4">}</span><span class="s8">`</span><span class="s4"> </span><span class="s1">// Re-use sequential IDs for simplicity</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (teamsInvolved.size !== </span><span class="s11">20</span><span class="s1">) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                 </span>showMessage(</span><span class="s1">`Fixtures must involve exactly 20 unique teams. Only </span><span class="s4">${teamsInvolved.size}</span><span class="s1"> unique teams selected.`</span><span class="s4">, </span><span class="s1">'bg-brand-pink'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">await</span><span class="s1"> setDoc(getFixturesDocRef(</span><span class="s9">GW_ID_NEW</span><span class="s1">), {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>gameweek: targetGw,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>matches: newFixtures,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>updatedAt: </span><span class="s7">new</span><span class="s1"> </span><span class="s9">Date</span><span class="s1">().toISOString(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>isLocked: </span><span class="s7">false</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">`Fixtures for Game Week </span><span class="s4">${targetGw}</span><span class="s1"> published successfully!`</span><span class="s4">, </span><span class="s1">'bg-brand-violet'</span><span class="s4">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>console.error(</span><span class="s1">"Error publishing upcoming fixtures: "</span><span class="s4">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s8">`Error publishing fixtures: </span><span class="s1">${e.message}</span><span class="s8">`</span><span class="s1">, </span><span class="s8">'bg-brand-pink'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Firebase Listeners ---</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Listener 4: Listen for Profile Data for the *currently loaded* user</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> setupProfileListener = (uid) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!uid) </span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>onSnapshot(getProfileDocRef(uid), (docSnap) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (docSnap.exists()) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>userProfile = docSnap.data();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>teamName = userProfile.teamName || </span><span class="s8">'Anonymous Predictor'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>userProfile = </span><span class="s7">null</span><span class="s1">; </span><span class="s12">// Profile was deleted or is missing</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>teamName = </span><span class="s8">'Anonymous Predictor'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>updateUI(); </span><span class="s1">// Important to update state after profile data changes</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}, (error) =&gt; { console.error(</span><span class="s8">"Error fetching user profile:"</span><span class="s1">, error); });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> setupListeners = (uid) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!uid) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>console.warn(</span><span class="s1">"Attempted to set up listeners without a valid UID."</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// 1. Setup Profile Listener (Critical for user context)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>setupProfileListener(uid);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// 2. Listen for Actual Results (Public Data)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>onSnapshot(getResultsDocRef(), (docSnap) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>actualResults = docSnap.exists() ? docSnap.data() : </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Recalculate score after results are posted/updated</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (userId) { </span><span class="s12">// If a user is signed in</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s7">const</span><span class="s1"> totalScore = calculateTotalScore(userPredictions, actualResults);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                     </span></span><span class="s1">// Update leaderboard publicly with the new score</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                     </span>setDoc(doc(getLeaderboardColRef(), userId), {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>totalScore: totalScore,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>lastUpdated: </span><span class="s7">new</span><span class="s1"> </span><span class="s9">Date</span><span class="s1">().toISOString(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>gameweek: </span><span class="s9">CURRENT_GAME_WEEK</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>userId: userId,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span>teamName: teamName </span><span class="s1">// Use the latest team name from local state</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}, { merge: </span><span class="s7">true</span><span class="s1"> }).</span><span class="s7">catch</span><span class="s1">(e =&gt; {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                        </span>console.error(</span><span class="s1">"Error updating leaderboard entry in results listener:"</span><span class="s4">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (mainView === </span><span class="s8">'user'</span><span class="s1"> || mainView === </span><span class="s8">'admin'</span><span class="s1">) {<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>updateUI();<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}, (error) =&gt; { console.error(</span><span class="s8">"Error fetching actual results:"</span><span class="s1">, error); });</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// 3. Listen for User Predictions (Private Data - Scoped by the currently loaded UID)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>onSnapshot(getPredictionsDocRef(uid), (docSnap) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userPredictions = docSnap.exists() ? docSnap.data().predictions : [];</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Recalculate score and update UI immediately</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (mainView === </span><span class="s8">'user'</span><span class="s1">) { updateUI(); }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}, (error) =&gt; { console.error(</span><span class="s8">"Error fetching user predictions:"</span><span class="s1">, error); });</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// 4. Listen for Leaderboard (Public Data)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>onSnapshot(query(getLeaderboardColRef()), (querySnapshot) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>leaderboardData = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>querySnapshot.forEach((doc) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>leaderboardData.push({ ...doc.data(), id: doc.id, userId: doc.id });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>leaderboardData.sort((a, b) =&gt; b.totalScore - a.totalScore);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (mainView === </span><span class="s8">'user'</span><span class="s1"> || mainView === </span><span class="s8">'admin'</span><span class="s1">) { updateUI(); }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}, (error) =&gt; { console.error(</span><span class="s8">"Error setting up leaderboard listener:"</span><span class="s1">, error); });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Auth Initialization ---</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> signInUser = </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Check for custom token provided by the canvas environment</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (initialAuthToken) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> signInWithCustomToken(auth, initialAuthToken);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Fallback to anonymous sign-in</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> signInAnonymously(auth);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">catch</span><span class="s1"> (error) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>console.error(</span><span class="s8">"Firebase Sign-in Failed:"</span><span class="s1">, error);</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">"Authentication failed. Cannot connect to the predictor league."</span><span class="s4">, </span><span class="s1">'bg-red-500'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Execute sign-in immediately</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>signInUser();</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Listen for authentication state changes</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>onAuthStateChanged(auth, </span><span class="s7">async</span><span class="s1"> (user) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (user) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> currentAuthId = user.uid;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Check if the current Firebase user ID has a profile</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> profileSnap = </span><span class="s7">await</span><span class="s1"> getDoc(getProfileDocRef(currentAuthId));</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (profileSnap.exists()) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Current session ID matches a registered profile</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>userProfile = profileSnap.data();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>teamName = userProfile.teamName || </span><span class="s8">'Anonymous Predictor'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>userId = currentAuthId;<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>mainView = </span><span class="s8">'user'</span><span class="s1">;<span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>setupListeners(userId);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Current session is anonymous/new and requires sign-up or sign-in</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>userProfile = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>userId = currentAuthId; </span><span class="s12">// Keep the anonymous ID for signup to use</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>mainView = </span><span class="s8">'auth-choice'</span><span class="s1">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// We only need the public/results/leaderboard listeners for anonymous users</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>setupListeners(userId);<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Sign-out or failed sign-in case</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userId = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>teamName = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userProfile = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>mainView = </span><span class="s8">'auth-choice'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>isAuthChecked = </span><span class="s7">true</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>updateUI();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Custom Tailwind Configuration ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>tailwind.config = {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>theme: {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>extend: {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>colors: {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">'brand-dark'</span><span class="s1">: </span><span class="s8">'#3D195B'</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">'brand-pink'</span><span class="s1">: </span><span class="s8">'#E90052'</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">'brand-violet'</span><span class="s1">: </span><span class="s8">'#963CFF'</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">'brand-pink-hover'</span><span class="s1">: </span><span class="s8">'#cf0048'</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">'brand-dark-hover'</span><span class="s1">: </span><span class="s8">'#32144b'</span><span class="s1">,</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s1">'brand-violet-hover'</span><span class="s4">: </span><span class="s1">'#7f21ff'</span><span class="s4">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s1"> { </span><span class="s2">font-family:</span><span class="s1"> </span><span class="s8">'Inter'</span><span class="s1">, </span><span class="s14">sans-serif</span><span class="s1">; }</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.tab-button.active</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-bottom-width:</span><span class="s4"> </span><span class="s15">3px</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-color:</span><span class="s1"> </span><span class="s14">#963CFF</span><span class="s1">;<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s14">#963CFF</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-50 min-h-screen"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"max-w-4xl mx-auto p-4 sm:p-8"</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Header and Status --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">header</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center mb-8 p-6 bg-white rounded-xl shadow-lg"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-4xl font-extrabold text-brand-dark mb-2"</span><span class="s3">&gt;</span><span class="s4">⚽ Predictor League</span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-gray-500"</span><span class="s3">&gt;</span><span class="s1">UK Premier League • Game Week </span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"gameweek-info"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"font-bold"</span><span class="s3">&gt;&lt;/</span><span class="s6">span</span><span class="s3">&gt;&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-3 text-sm flex justify-center space-x-4"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"auth-status"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-gray-600"</span><span class="s3">&gt;</span><span class="s1">Initializing...</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Admin Toggle Button --&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s2">id</span><span class="s3">=</span><span class="s1">"admin-mode-toggle"</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"window.toggleAdminMode()"</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-4 px-4 py-2 text-sm font-semibold rounded-lg text-white transition duration-300 bg-brand-pink hover:bg-brand-pink-hover"</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s2">style</span><span class="s3">=</span><span class="s5">"display: none;"</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>Enable Admin Mode</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">header</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Message Box --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"message-box"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-3 rounded-lg text-white text-center transition-opacity duration-300 mb-4 opacity-0"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Main Content Area --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"app-content"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"h-20"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">             </span></span><span class="s1">&lt;!-- Loading spinner is displayed initially --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">             </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center p-12 text-gray-600"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                 </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-violet mx-auto mb-4"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>Loading application...</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text/javascript"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Expose necessary functions globally for HTML event handlers</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// This is necessary because the main logic is in a type="module" script</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (</span><span class="s7">typeof</span><span class="s1"> window.toggleAdminMode === </span><span class="s8">'undefined'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>window.toggleAdminMode = () =&gt; { console.error(</span><span class="s8">"toggleAdminMode not loaded."</span><span class="s1">); };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (</span><span class="s7">typeof</span><span class="s1"> window.navigateTo === </span><span class="s8">'undefined'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>window.navigateTo = (view) =&gt; { console.error(</span><span class="s8">"navigateTo not loaded."</span><span class="s1">); };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (</span><span class="s7">typeof</span><span class="s1"> window.handlePredictionChange === </span><span class="s8">'undefined'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>window.handlePredictionChange = (id, field, value) =&gt; { console.error(</span><span class="s8">"handlePredictionChange not loaded."</span><span class="s1">); };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
</body>
</html>
